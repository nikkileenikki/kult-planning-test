import{j as e}from"./index-C1JaId44.js";import{d as A,r as l}from"./vendor-7lAwbL4C.js";import{a as p}from"./utils-B9ygI19o.js";import{L}from"./Layout-BIIFe71_.js";function I(){const d=A(),[f,y]=l.useState(null),[c,N]=l.useState([]),[o,v]=l.useState([]),[w,b]=l.useState(!0),[x,k]=l.useState({totalClients:0,totalCampaigns:0,bookedCampaigns:0,totalRevenue:0});l.useEffect(()=>{C(),B()},[]);const C=async()=>{const s=localStorage.getItem("token");try{const t=await p.get("/api/auth/me",{headers:{Authorization:`Bearer ${s}`}});y(t.data.user)}catch(t){console.error("Failed to load user:",t),d("/login")}},B=async()=>{const s=localStorage.getItem("token");try{b(!0);const a=((await p.get("/api/admin/organizations",{headers:{Authorization:`Bearer ${s}`}})).data.organizations||[]).filter(n=>n.assignedSalesPersonId===f.id);N(a);const r=((await p.get("/api/campaign-workflow/my-campaigns",{headers:{Authorization:`Bearer ${s}`}})).data.campaigns||[]).filter(n=>a.some(g=>g.id===n.organizationId));v(r);const u=r.filter(n=>n.status==="booked"||n.status==="in_progress"||n.status==="live"),z=u.reduce((n,g)=>n+(g.totalBudget||0),0);k({totalClients:a.length,totalCampaigns:r.length,bookedCampaigns:u.length,totalRevenue:z})}catch(t){console.error("Failed to load sales dashboard:",t)}finally{b(!1)}},j=s=>{const t={draft:{bg:"bg-gray-600",text:"Draft"},pending_approval:{bg:"bg-yellow-600",text:"Pending"},approved:{bg:"bg-green-600",text:"Approved"},rejected:{bg:"bg-red-600",text:"Rejected"},booked:{bg:"bg-blue-600",text:"Booked"},in_progress:{bg:"bg-purple-600",text:"In Progress"},live:{bg:"bg-cyan-600",text:"Live"},completed:{bg:"bg-gray-500",text:"Completed"}},a=t[s]||t.draft;return e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold text-white ${a.bg}`,children:a.text})},m=s=>new Intl.NumberFormat("en-MY",{style:"currency",currency:"MYR",minimumFractionDigits:0}).format(s),S=s=>o.filter(t=>t.organizationId===s);return w?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-400",children:"Loading dashboard..."})]})}):e.jsx(L,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Sales Dashboard"}),e.jsx("p",{className:"text-gray-400",children:"Manage your clients and campaign bookings"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-[#0f1419] border border-gray-800 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"My Clients"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:x.totalClients})]}),e.jsx("svg",{className:"w-10 h-10 text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})]})}),e.jsx("div",{className:"bg-[#0f1419] border border-gray-800 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Total Campaigns"}),e.jsx("p",{className:"text-3xl font-bold text-white",children:x.totalCampaigns})]}),e.jsx("svg",{className:"w-10 h-10 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})]})}),e.jsx("div",{className:"bg-[#0f1419] border border-gray-800 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Booked"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400",children:x.bookedCampaigns})]}),e.jsx("div",{className:"text-4xl",children:"ğŸ“…"})]})}),e.jsx("div",{className:"bg-[#0f1419] border border-gray-800 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-400 text-sm mb-1",children:"Total Revenue"}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:m(x.totalRevenue)})]}),e.jsx("div",{className:"text-4xl",children:"ğŸ’°"})]})})]}),e.jsxs("div",{className:"bg-[#0f1419] border border-gray-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),e.jsx("span",{children:"My Clients"})]}),c.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-400",children:"No clients assigned yet"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(s=>{var i,h;const t=S(s.id),a=t.filter(r=>r.status==="booked"||r.status==="in_progress"||r.status==="live").length;return e.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-5 hover:border-cyan-500 transition-all cursor-pointer",onClick:()=>d(`/sales/client/${s.id}`),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-semibold text-lg mb-1",children:s.name}),e.jsx("p",{className:"text-gray-400 text-sm capitalize",children:(i=s.industry)==null?void 0:i.replace("_"," ")})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${s.status==="active"?"bg-green-600 text-white":"bg-gray-600 text-white"}`,children:s.status})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-gray-400",children:[e.jsx("span",{children:"Admin:"}),e.jsx("span",{className:"text-white",children:s.adminName||"N/A"})]}),e.jsxs("div",{className:"flex justify-between text-gray-400",children:[e.jsx("span",{children:"Team Size:"}),e.jsx("span",{className:"text-white",children:((h=s.teamMembers)==null?void 0:h.length)||0})]}),e.jsxs("div",{className:"flex justify-between text-gray-400",children:[e.jsx("span",{children:"Campaigns:"}),e.jsx("span",{className:"text-white",children:t.length})]}),e.jsxs("div",{className:"flex justify-between text-gray-400",children:[e.jsx("span",{children:"Booked:"}),e.jsx("span",{className:"text-blue-400 font-semibold",children:a})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700",children:e.jsx("button",{onClick:r=>{r.stopPropagation(),window.location.href=`mailto:${s.adminEmail}`},className:"w-full bg-cyan-600 hover:bg-cyan-700 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm",children:"ğŸ“§ Contact Admin"})})]},s.id)})})]}),e.jsxs("div",{className:"bg-[#0f1419] border border-gray-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx("span",{children:"ğŸ“…"}),e.jsx("span",{children:"Recent Campaign Bookings"})]}),o.filter(s=>s.status==="booked"||s.status==="in_progress"||s.status==="live").length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-400",children:"No booked campaigns yet"})}):e.jsx("div",{className:"space-y-3",children:o.filter(s=>s.status==="booked"||s.status==="in_progress"||s.status==="live").sort((s,t)=>{var a,i;return new Date(((a=t.workflow)==null?void 0:a.bookedAt)||0)-new Date(((i=s.workflow)==null?void 0:i.bookedAt)||0)}).slice(0,10).map(s=>{var a;const t=c.find(i=>i.id===s.organizationId);return e.jsx("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-4 hover:border-cyan-500 transition-all",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-white font-semibold",children:s.campaignName||"Untitled Campaign"}),j(s.status)]}),e.jsxs("p",{className:"text-gray-400 text-sm mb-2",children:[t==null?void 0:t.name," â€¢ ",s.advertiserName," â€¢ ",s.objective]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-400",children:["Budget: ",e.jsx("span",{className:"text-white font-medium",children:m(s.totalBudget||0)})]}),((a=s.workflow)==null?void 0:a.bookedAt)&&e.jsxs("span",{className:"text-gray-400",children:["Booked: ",e.jsx("span",{className:"text-blue-400",children:new Date(s.workflow.bookedAt).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("button",{onClick:()=>d(`/campaigns/${s.id}`),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:"ğŸ‘ï¸ View"}),t&&e.jsx("button",{onClick:()=>window.location.href=`mailto:${t.adminEmail}`,className:"px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium transition-colors",children:"ğŸ“§ Contact"})]})]})},s.id)})})]}),e.jsxs("div",{className:"bg-[#0f1419] border border-gray-800 rounded-xl p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white mb-4 flex items-center gap-2",children:[e.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),e.jsx("span",{children:"All Client Campaigns"})]}),o.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-400",children:"No campaigns yet"})}):e.jsx("div",{className:"space-y-3",children:o.sort((s,t)=>new Date(t.createdAt)-new Date(s.createdAt)).map(s=>{const t=c.find(a=>a.id===s.organizationId);return e.jsx("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-4 hover:border-cyan-500 transition-all",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-white font-semibold",children:s.campaignName||"Untitled Campaign"}),j(s.status)]}),e.jsxs("p",{className:"text-gray-400 text-sm mb-2",children:[t==null?void 0:t.name," â€¢ ",s.advertiserName]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-gray-400",children:["Budget: ",e.jsx("span",{className:"text-white",children:m(s.totalBudget||0)})]}),e.jsxs("span",{className:"text-gray-400",children:["Created: ",new Date(s.createdAt).toLocaleDateString()]})]})]}),e.jsx("button",{onClick:()=>d(`/campaigns/${s.id}`),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:"ğŸ‘ï¸ View"})]})},s.id)})})]})]})})}export{I as default};
